service: afterwork-serverless
provider:
  name: aws
  runtime: nodejs4.3
  stage: dev 
  region: eu-west-1
  profile: goforecrew
  iamRoleStatements:
    - Effect: Allow
      Action:
        - dynamodb:Query
        - dynamodb:PutItem
        - dynamodb:UpdateItem
        - dynamodb:Scan
        - dynamodb:GetItem
      Resource: "arn:aws:dynamodb:eu-west-1:*:*"

custom: ${file(config.yml)}

functions:
  afterworkLogin:
    handler: serverless/src/user.login
    events:
      - http:
          path: login
          method: post
          cors: true
          request:
            template:
              application/json: { "body": "$input.json(''$'')" }
    memorySize: 128
  afterworkRegister:
    handler: serverless/src/user.register
    events:
      - http:
          path: reqister
          method: post
          cors: true
    environment:
      SLACK_REGISTER_TOKEN: ${self:custom.slack_register_token}
    memorySize: 128


  #saveChecking:
  #  handler: serverless/src/handler.saveChecking
  #  events:
  #    - http:
  #      path: saveChecking
    #      method: post
    #      cors: true
    #      private: true
    #      request:
    #        template:
    #          application/json: { "body": "$input.json(''$)" }
  #searchVenues:
  #  handler: serverless/src/handler.searchVenues
  #  events:
  #    - http:
    #      path: venues
    #      method: get
    #      cors: true
    #      private: true
    #      request:
    #        template:
    #          application/json: >
    #          '{
    #            "ll" : "$input.params(''ll'')"
    #          }'
  #  environment:
  #    CLIENT_ID: ${env:FOURSQUORECLIENDIT}
  #    CLIENT_SECRET: ${env:FOURSQUORECLIENDSECRET}
  #    RADIUS: ${env:RADIUS}

resources:
  Resources:
    usersTable:
      Type: AWS::DynamoDB::Table
      Properties:
        TableName: afterworkUsers
        AttributeDefinitions:
          - AttributeName: slack_id
            AttributeType: S
        KeySchema:
          - AttributeName: slack_id
            KeyType: HASH
        ProvisionedThroughput:
          ReadCapacityUnits: 1
          WriteCapacityUnits: 1
    checkingsTable:
      Type: AWS::DynamoDB::Table
      Properties:
        TableName: afterworkCheckings
        AttributeDefinitions:
          - AttributeName: id
            AttributeType: S
        KeySchema:
          - AttributeName: id
            KeyType: HASH
        ProvisionedThroughput:
          ReadCapacityUnits: 1
          WriteCapacityUnits: 1